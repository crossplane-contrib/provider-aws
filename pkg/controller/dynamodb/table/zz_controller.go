/*
Copyright 2021 The Crossplane Authors.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/

// Code generated by ack-generate. DO NOT EDIT.

package table

import (
	"context"

	svcapi "github.com/aws/aws-sdk-go/service/dynamodb"
	svcsdk "github.com/aws/aws-sdk-go/service/dynamodb"
	svcsdkapi "github.com/aws/aws-sdk-go/service/dynamodb/dynamodbiface"
	"github.com/google/go-cmp/cmp"
	"github.com/pkg/errors"
	metav1 "k8s.io/apimachinery/pkg/apis/meta/v1"
	"sigs.k8s.io/controller-runtime/pkg/client"

	xpv1 "github.com/crossplane/crossplane-runtime/apis/common/v1"
	"github.com/crossplane/crossplane-runtime/pkg/meta"
	"github.com/crossplane/crossplane-runtime/pkg/reconciler/managed"
	cpresource "github.com/crossplane/crossplane-runtime/pkg/resource"

	svcapitypes "github.com/crossplane-contrib/provider-aws/apis/dynamodb/v1alpha1"
	connectaws "github.com/crossplane-contrib/provider-aws/pkg/utils/connect/aws"
	errorutils "github.com/crossplane-contrib/provider-aws/pkg/utils/errors"
)

const (
	errUnexpectedObject = "managed resource is not an Table resource"

	errCreateSession = "cannot create a new session"
	errCreate        = "cannot create Table in AWS"
	errUpdate        = "cannot update Table in AWS"
	errDescribe      = "failed to describe Table"
	errDelete        = "failed to delete Table"
)

type connector struct {
	kube client.Client
	opts []option
}

func (c *connector) Connect(ctx context.Context, cr *svcapitypes.Table) (managed.TypedExternalClient[*svcapitypes.Table], error) {
	sess, err := connectaws.GetConfigV1(ctx, c.kube, cr, cr.Spec.ForProvider.Region)
	if err != nil {
		return nil, errors.Wrap(err, errCreateSession)
	}
	return newExternal(c.kube, svcapi.New(sess), c.opts), nil
}

func (e *external) Observe(ctx context.Context, cr *svcapitypes.Table) (managed.ExternalObservation, error) {
	if meta.GetExternalName(cr) == "" {
		return managed.ExternalObservation{
			ResourceExists: false,
		}, nil
	}
	input := GenerateDescribeTableInput(cr)
	if err := e.preObserve(ctx, cr, input); err != nil {
		return managed.ExternalObservation{}, errors.Wrap(err, "pre-observe failed")
	}
	resp, err := e.client.DescribeTableWithContext(ctx, input)
	if err != nil {
		return managed.ExternalObservation{ResourceExists: false}, errorutils.Wrap(cpresource.Ignore(IsNotFound, err), errDescribe)
	}
	currentSpec := cr.Spec.ForProvider.DeepCopy()
	if err := e.lateInitialize(&cr.Spec.ForProvider, resp); err != nil {
		return managed.ExternalObservation{}, errors.Wrap(err, "late-init failed")
	}
	GenerateTable(resp).Status.AtProvider.DeepCopyInto(&cr.Status.AtProvider)
	upToDate := true
	diff := ""
	if !meta.WasDeleted(cr) { // There is no need to run isUpToDate if the resource is deleted
		upToDate, diff, err = e.isUpToDate(ctx, cr, resp)
		if err != nil {
			return managed.ExternalObservation{}, errors.Wrap(err, "isUpToDate check failed")
		}
	}
	return e.postObserve(ctx, cr, resp, managed.ExternalObservation{
		ResourceExists:          true,
		ResourceUpToDate:        upToDate,
		Diff:                    diff,
		ResourceLateInitialized: !cmp.Equal(&cr.Spec.ForProvider, currentSpec),
	}, nil)
}

func (e *external) Create(ctx context.Context, cr *svcapitypes.Table) (managed.ExternalCreation, error) {
	cr.Status.SetConditions(xpv1.Creating())
	input := GenerateCreateTableInput(cr)
	if err := e.preCreate(ctx, cr, input); err != nil {
		return managed.ExternalCreation{}, errors.Wrap(err, "pre-create failed")
	}
	resp, err := e.client.CreateTableWithContext(ctx, input)
	if err != nil {
		return managed.ExternalCreation{}, errorutils.Wrap(err, errCreate)
	}

	if resp.TableDescription.ArchivalSummary != nil {
		f0 := &svcapitypes.ArchivalSummary{}
		if resp.TableDescription.ArchivalSummary.ArchivalBackupArn != nil {
			f0.ArchivalBackupARN = resp.TableDescription.ArchivalSummary.ArchivalBackupArn
		}
		if resp.TableDescription.ArchivalSummary.ArchivalDateTime != nil {
			f0.ArchivalDateTime = &metav1.Time{*resp.TableDescription.ArchivalSummary.ArchivalDateTime}
		}
		if resp.TableDescription.ArchivalSummary.ArchivalReason != nil {
			f0.ArchivalReason = resp.TableDescription.ArchivalSummary.ArchivalReason
		}
		cr.Status.AtProvider.ArchivalSummary = f0
	} else {
		cr.Status.AtProvider.ArchivalSummary = nil
	}
	if resp.TableDescription.AttributeDefinitions != nil {
		f1 := []*svcapitypes.AttributeDefinition{}
		for _, f1iter := range resp.TableDescription.AttributeDefinitions {
			f1elem := &svcapitypes.AttributeDefinition{}
			if f1iter.AttributeName != nil {
				f1elem.AttributeName = f1iter.AttributeName
			}
			if f1iter.AttributeType != nil {
				f1elem.AttributeType = f1iter.AttributeType
			}
			f1 = append(f1, f1elem)
		}
		cr.Spec.ForProvider.AttributeDefinitions = f1
	} else {
		cr.Spec.ForProvider.AttributeDefinitions = nil
	}
	if resp.TableDescription.BillingModeSummary != nil {
		f2 := &svcapitypes.BillingModeSummary{}
		if resp.TableDescription.BillingModeSummary.BillingMode != nil {
			f2.BillingMode = resp.TableDescription.BillingModeSummary.BillingMode
		}
		if resp.TableDescription.BillingModeSummary.LastUpdateToPayPerRequestDateTime != nil {
			f2.LastUpdateToPayPerRequestDateTime = &metav1.Time{*resp.TableDescription.BillingModeSummary.LastUpdateToPayPerRequestDateTime}
		}
		cr.Status.AtProvider.BillingModeSummary = f2
	} else {
		cr.Status.AtProvider.BillingModeSummary = nil
	}
	if resp.TableDescription.CreationDateTime != nil {
		cr.Status.AtProvider.CreationDateTime = &metav1.Time{*resp.TableDescription.CreationDateTime}
	} else {
		cr.Status.AtProvider.CreationDateTime = nil
	}
	if resp.TableDescription.DeletionProtectionEnabled != nil {
		cr.Spec.ForProvider.DeletionProtectionEnabled = resp.TableDescription.DeletionProtectionEnabled
	} else {
		cr.Spec.ForProvider.DeletionProtectionEnabled = nil
	}
	if resp.TableDescription.GlobalSecondaryIndexes != nil {
		f5 := []*svcapitypes.GlobalSecondaryIndex{}
		for _, f5iter := range resp.TableDescription.GlobalSecondaryIndexes {
			f5elem := &svcapitypes.GlobalSecondaryIndex{}
			if f5iter.IndexName != nil {
				f5elem.IndexName = f5iter.IndexName
			}
			if f5iter.KeySchema != nil {
				f5elemf6 := []*svcapitypes.KeySchemaElement{}
				for _, f5elemf6iter := range f5iter.KeySchema {
					f5elemf6elem := &svcapitypes.KeySchemaElement{}
					if f5elemf6iter.AttributeName != nil {
						f5elemf6elem.AttributeName = f5elemf6iter.AttributeName
					}
					if f5elemf6iter.KeyType != nil {
						f5elemf6elem.KeyType = f5elemf6iter.KeyType
					}
					f5elemf6 = append(f5elemf6, f5elemf6elem)
				}
				f5elem.KeySchema = f5elemf6
			}
			if f5iter.OnDemandThroughput != nil {
				f5elemf7 := &svcapitypes.OnDemandThroughput{}
				if f5iter.OnDemandThroughput.MaxReadRequestUnits != nil {
					f5elemf7.MaxReadRequestUnits = f5iter.OnDemandThroughput.MaxReadRequestUnits
				}
				if f5iter.OnDemandThroughput.MaxWriteRequestUnits != nil {
					f5elemf7.MaxWriteRequestUnits = f5iter.OnDemandThroughput.MaxWriteRequestUnits
				}
				f5elem.OnDemandThroughput = f5elemf7
			}
			if f5iter.Projection != nil {
				f5elemf8 := &svcapitypes.Projection{}
				if f5iter.Projection.NonKeyAttributes != nil {
					f5elemf8f0 := []*string{}
					for _, f5elemf8f0iter := range f5iter.Projection.NonKeyAttributes {
						var f5elemf8f0elem string
						f5elemf8f0elem = *f5elemf8f0iter
						f5elemf8f0 = append(f5elemf8f0, &f5elemf8f0elem)
					}
					f5elemf8.NonKeyAttributes = f5elemf8f0
				}
				if f5iter.Projection.ProjectionType != nil {
					f5elemf8.ProjectionType = f5iter.Projection.ProjectionType
				}
				f5elem.Projection = f5elemf8
			}
			if f5iter.ProvisionedThroughput != nil {
				f5elemf9 := &svcapitypes.ProvisionedThroughput{}
				if f5iter.ProvisionedThroughput.ReadCapacityUnits != nil {
					f5elemf9.ReadCapacityUnits = f5iter.ProvisionedThroughput.ReadCapacityUnits
				}
				if f5iter.ProvisionedThroughput.WriteCapacityUnits != nil {
					f5elemf9.WriteCapacityUnits = f5iter.ProvisionedThroughput.WriteCapacityUnits
				}
				f5elem.ProvisionedThroughput = f5elemf9
			}
			f5 = append(f5, f5elem)
		}
		cr.Spec.ForProvider.GlobalSecondaryIndexes = f5
	} else {
		cr.Spec.ForProvider.GlobalSecondaryIndexes = nil
	}
	if resp.TableDescription.GlobalTableVersion != nil {
		cr.Status.AtProvider.GlobalTableVersion = resp.TableDescription.GlobalTableVersion
	} else {
		cr.Status.AtProvider.GlobalTableVersion = nil
	}
	if resp.TableDescription.ItemCount != nil {
		cr.Status.AtProvider.ItemCount = resp.TableDescription.ItemCount
	} else {
		cr.Status.AtProvider.ItemCount = nil
	}
	if resp.TableDescription.KeySchema != nil {
		f8 := []*svcapitypes.KeySchemaElement{}
		for _, f8iter := range resp.TableDescription.KeySchema {
			f8elem := &svcapitypes.KeySchemaElement{}
			if f8iter.AttributeName != nil {
				f8elem.AttributeName = f8iter.AttributeName
			}
			if f8iter.KeyType != nil {
				f8elem.KeyType = f8iter.KeyType
			}
			f8 = append(f8, f8elem)
		}
		cr.Spec.ForProvider.KeySchema = f8
	} else {
		cr.Spec.ForProvider.KeySchema = nil
	}
	if resp.TableDescription.LatestStreamArn != nil {
		cr.Status.AtProvider.LatestStreamARN = resp.TableDescription.LatestStreamArn
	} else {
		cr.Status.AtProvider.LatestStreamARN = nil
	}
	if resp.TableDescription.LatestStreamLabel != nil {
		cr.Status.AtProvider.LatestStreamLabel = resp.TableDescription.LatestStreamLabel
	} else {
		cr.Status.AtProvider.LatestStreamLabel = nil
	}
	if resp.TableDescription.LocalSecondaryIndexes != nil {
		f11 := []*svcapitypes.LocalSecondaryIndex{}
		for _, f11iter := range resp.TableDescription.LocalSecondaryIndexes {
			f11elem := &svcapitypes.LocalSecondaryIndex{}
			if f11iter.IndexName != nil {
				f11elem.IndexName = f11iter.IndexName
			}
			if f11iter.KeySchema != nil {
				f11elemf4 := []*svcapitypes.KeySchemaElement{}
				for _, f11elemf4iter := range f11iter.KeySchema {
					f11elemf4elem := &svcapitypes.KeySchemaElement{}
					if f11elemf4iter.AttributeName != nil {
						f11elemf4elem.AttributeName = f11elemf4iter.AttributeName
					}
					if f11elemf4iter.KeyType != nil {
						f11elemf4elem.KeyType = f11elemf4iter.KeyType
					}
					f11elemf4 = append(f11elemf4, f11elemf4elem)
				}
				f11elem.KeySchema = f11elemf4
			}
			if f11iter.Projection != nil {
				f11elemf5 := &svcapitypes.Projection{}
				if f11iter.Projection.NonKeyAttributes != nil {
					f11elemf5f0 := []*string{}
					for _, f11elemf5f0iter := range f11iter.Projection.NonKeyAttributes {
						var f11elemf5f0elem string
						f11elemf5f0elem = *f11elemf5f0iter
						f11elemf5f0 = append(f11elemf5f0, &f11elemf5f0elem)
					}
					f11elemf5.NonKeyAttributes = f11elemf5f0
				}
				if f11iter.Projection.ProjectionType != nil {
					f11elemf5.ProjectionType = f11iter.Projection.ProjectionType
				}
				f11elem.Projection = f11elemf5
			}
			f11 = append(f11, f11elem)
		}
		cr.Spec.ForProvider.LocalSecondaryIndexes = f11
	} else {
		cr.Spec.ForProvider.LocalSecondaryIndexes = nil
	}
	if resp.TableDescription.OnDemandThroughput != nil {
		f12 := &svcapitypes.OnDemandThroughput{}
		if resp.TableDescription.OnDemandThroughput.MaxReadRequestUnits != nil {
			f12.MaxReadRequestUnits = resp.TableDescription.OnDemandThroughput.MaxReadRequestUnits
		}
		if resp.TableDescription.OnDemandThroughput.MaxWriteRequestUnits != nil {
			f12.MaxWriteRequestUnits = resp.TableDescription.OnDemandThroughput.MaxWriteRequestUnits
		}
		cr.Spec.ForProvider.OnDemandThroughput = f12
	} else {
		cr.Spec.ForProvider.OnDemandThroughput = nil
	}
	if resp.TableDescription.ProvisionedThroughput != nil {
		f13 := &svcapitypes.ProvisionedThroughput{}
		if resp.TableDescription.ProvisionedThroughput.ReadCapacityUnits != nil {
			f13.ReadCapacityUnits = resp.TableDescription.ProvisionedThroughput.ReadCapacityUnits
		}
		if resp.TableDescription.ProvisionedThroughput.WriteCapacityUnits != nil {
			f13.WriteCapacityUnits = resp.TableDescription.ProvisionedThroughput.WriteCapacityUnits
		}
		cr.Spec.ForProvider.ProvisionedThroughput = f13
	} else {
		cr.Spec.ForProvider.ProvisionedThroughput = nil
	}
	if resp.TableDescription.Replicas != nil {
		f14 := []*svcapitypes.ReplicaDescription{}
		for _, f14iter := range resp.TableDescription.Replicas {
			f14elem := &svcapitypes.ReplicaDescription{}
			if f14iter.GlobalSecondaryIndexes != nil {
				f14elemf0 := []*svcapitypes.ReplicaGlobalSecondaryIndexDescription{}
				for _, f14elemf0iter := range f14iter.GlobalSecondaryIndexes {
					f14elemf0elem := &svcapitypes.ReplicaGlobalSecondaryIndexDescription{}
					if f14elemf0iter.IndexName != nil {
						f14elemf0elem.IndexName = f14elemf0iter.IndexName
					}
					if f14elemf0iter.OnDemandThroughputOverride != nil {
						f14elemf0elemf1 := &svcapitypes.OnDemandThroughputOverride{}
						if f14elemf0iter.OnDemandThroughputOverride.MaxReadRequestUnits != nil {
							f14elemf0elemf1.MaxReadRequestUnits = f14elemf0iter.OnDemandThroughputOverride.MaxReadRequestUnits
						}
						f14elemf0elem.OnDemandThroughputOverride = f14elemf0elemf1
					}
					if f14elemf0iter.ProvisionedThroughputOverride != nil {
						f14elemf0elemf2 := &svcapitypes.ProvisionedThroughputOverride{}
						if f14elemf0iter.ProvisionedThroughputOverride.ReadCapacityUnits != nil {
							f14elemf0elemf2.ReadCapacityUnits = f14elemf0iter.ProvisionedThroughputOverride.ReadCapacityUnits
						}
						f14elemf0elem.ProvisionedThroughputOverride = f14elemf0elemf2
					}
					f14elemf0 = append(f14elemf0, f14elemf0elem)
				}
				f14elem.GlobalSecondaryIndexes = f14elemf0
			}
			if f14iter.KMSMasterKeyId != nil {
				f14elem.KMSMasterKeyID = f14iter.KMSMasterKeyId
			}
			if f14iter.OnDemandThroughputOverride != nil {
				f14elemf2 := &svcapitypes.OnDemandThroughputOverride{}
				if f14iter.OnDemandThroughputOverride.MaxReadRequestUnits != nil {
					f14elemf2.MaxReadRequestUnits = f14iter.OnDemandThroughputOverride.MaxReadRequestUnits
				}
				f14elem.OnDemandThroughputOverride = f14elemf2
			}
			if f14iter.ProvisionedThroughputOverride != nil {
				f14elemf3 := &svcapitypes.ProvisionedThroughputOverride{}
				if f14iter.ProvisionedThroughputOverride.ReadCapacityUnits != nil {
					f14elemf3.ReadCapacityUnits = f14iter.ProvisionedThroughputOverride.ReadCapacityUnits
				}
				f14elem.ProvisionedThroughputOverride = f14elemf3
			}
			if f14iter.RegionName != nil {
				f14elem.RegionName = f14iter.RegionName
			}
			if f14iter.ReplicaInaccessibleDateTime != nil {
				f14elem.ReplicaInaccessibleDateTime = &metav1.Time{*f14iter.ReplicaInaccessibleDateTime}
			}
			if f14iter.ReplicaStatus != nil {
				f14elem.ReplicaStatus = f14iter.ReplicaStatus
			}
			if f14iter.ReplicaStatusDescription != nil {
				f14elem.ReplicaStatusDescription = f14iter.ReplicaStatusDescription
			}
			if f14iter.ReplicaStatusPercentProgress != nil {
				f14elem.ReplicaStatusPercentProgress = f14iter.ReplicaStatusPercentProgress
			}
			if f14iter.ReplicaTableClassSummary != nil {
				f14elemf9 := &svcapitypes.TableClassSummary{}
				if f14iter.ReplicaTableClassSummary.LastUpdateDateTime != nil {
					f14elemf9.LastUpdateDateTime = &metav1.Time{*f14iter.ReplicaTableClassSummary.LastUpdateDateTime}
				}
				if f14iter.ReplicaTableClassSummary.TableClass != nil {
					f14elemf9.TableClass = f14iter.ReplicaTableClassSummary.TableClass
				}
				f14elem.ReplicaTableClassSummary = f14elemf9
			}
			f14 = append(f14, f14elem)
		}
		cr.Status.AtProvider.Replicas = f14
	} else {
		cr.Status.AtProvider.Replicas = nil
	}
	if resp.TableDescription.RestoreSummary != nil {
		f15 := &svcapitypes.RestoreSummary{}
		if resp.TableDescription.RestoreSummary.RestoreDateTime != nil {
			f15.RestoreDateTime = &metav1.Time{*resp.TableDescription.RestoreSummary.RestoreDateTime}
		}
		if resp.TableDescription.RestoreSummary.RestoreInProgress != nil {
			f15.RestoreInProgress = resp.TableDescription.RestoreSummary.RestoreInProgress
		}
		if resp.TableDescription.RestoreSummary.SourceBackupArn != nil {
			f15.SourceBackupARN = resp.TableDescription.RestoreSummary.SourceBackupArn
		}
		if resp.TableDescription.RestoreSummary.SourceTableArn != nil {
			f15.SourceTableARN = resp.TableDescription.RestoreSummary.SourceTableArn
		}
		cr.Status.AtProvider.RestoreSummary = f15
	} else {
		cr.Status.AtProvider.RestoreSummary = nil
	}
	if resp.TableDescription.SSEDescription != nil {
		f16 := &svcapitypes.SSEDescription{}
		if resp.TableDescription.SSEDescription.InaccessibleEncryptionDateTime != nil {
			f16.InaccessibleEncryptionDateTime = &metav1.Time{*resp.TableDescription.SSEDescription.InaccessibleEncryptionDateTime}
		}
		if resp.TableDescription.SSEDescription.KMSMasterKeyArn != nil {
			f16.KMSMasterKeyARN = resp.TableDescription.SSEDescription.KMSMasterKeyArn
		}
		if resp.TableDescription.SSEDescription.SSEType != nil {
			f16.SSEType = resp.TableDescription.SSEDescription.SSEType
		}
		if resp.TableDescription.SSEDescription.Status != nil {
			f16.Status = resp.TableDescription.SSEDescription.Status
		}
		cr.Status.AtProvider.SSEDescription = f16
	} else {
		cr.Status.AtProvider.SSEDescription = nil
	}
	if resp.TableDescription.StreamSpecification != nil {
		f17 := &svcapitypes.StreamSpecification{}
		if resp.TableDescription.StreamSpecification.StreamEnabled != nil {
			f17.StreamEnabled = resp.TableDescription.StreamSpecification.StreamEnabled
		}
		if resp.TableDescription.StreamSpecification.StreamViewType != nil {
			f17.StreamViewType = resp.TableDescription.StreamSpecification.StreamViewType
		}
		cr.Spec.ForProvider.StreamSpecification = f17
	} else {
		cr.Spec.ForProvider.StreamSpecification = nil
	}
	if resp.TableDescription.TableArn != nil {
		cr.Status.AtProvider.TableARN = resp.TableDescription.TableArn
	} else {
		cr.Status.AtProvider.TableARN = nil
	}
	if resp.TableDescription.TableClassSummary != nil {
		f19 := &svcapitypes.TableClassSummary{}
		if resp.TableDescription.TableClassSummary.LastUpdateDateTime != nil {
			f19.LastUpdateDateTime = &metav1.Time{*resp.TableDescription.TableClassSummary.LastUpdateDateTime}
		}
		if resp.TableDescription.TableClassSummary.TableClass != nil {
			f19.TableClass = resp.TableDescription.TableClassSummary.TableClass
		}
		cr.Status.AtProvider.TableClassSummary = f19
	} else {
		cr.Status.AtProvider.TableClassSummary = nil
	}
	if resp.TableDescription.TableId != nil {
		cr.Status.AtProvider.TableID = resp.TableDescription.TableId
	} else {
		cr.Status.AtProvider.TableID = nil
	}
	if resp.TableDescription.TableName != nil {
		cr.Status.AtProvider.TableName = resp.TableDescription.TableName
	} else {
		cr.Status.AtProvider.TableName = nil
	}
	if resp.TableDescription.TableSizeBytes != nil {
		cr.Status.AtProvider.TableSizeBytes = resp.TableDescription.TableSizeBytes
	} else {
		cr.Status.AtProvider.TableSizeBytes = nil
	}
	if resp.TableDescription.TableStatus != nil {
		cr.Status.AtProvider.TableStatus = resp.TableDescription.TableStatus
	} else {
		cr.Status.AtProvider.TableStatus = nil
	}

	return e.postCreate(ctx, cr, resp, managed.ExternalCreation{}, err)
}

func (e *external) Update(ctx context.Context, cr *svcapitypes.Table) (managed.ExternalUpdate, error) {
	input := GenerateUpdateTableInput(cr)
	if err := e.preUpdate(ctx, cr, input); err != nil {
		return managed.ExternalUpdate{}, errors.Wrap(err, "pre-update failed")
	}
	resp, err := e.client.UpdateTableWithContext(ctx, input)
	return e.postUpdate(ctx, cr, resp, managed.ExternalUpdate{}, errorutils.Wrap(err, errUpdate))
}

func (e *external) Delete(ctx context.Context, cr *svcapitypes.Table) (managed.ExternalDelete, error) {
	cr.Status.SetConditions(xpv1.Deleting())
	input := GenerateDeleteTableInput(cr)
	ignore, err := e.preDelete(ctx, cr, input)
	if err != nil {
		return managed.ExternalDelete{}, errors.Wrap(err, "pre-delete failed")
	}
	if ignore {
		return managed.ExternalDelete{}, nil
	}
	resp, err := e.client.DeleteTableWithContext(ctx, input)
	return e.postDelete(ctx, cr, resp, errorutils.Wrap(cpresource.Ignore(IsNotFound, err), errDelete))
}

func (e *external) Disconnect(ctx context.Context) error {
	// Unimplemented, required by newer versions of crossplane-runtime
	return nil
}

type option func(*external)

func newExternal(kube client.Client, client svcsdkapi.DynamoDBAPI, opts []option) *external {
	e := &external{
		kube:           kube,
		client:         client,
		preObserve:     nopPreObserve,
		postObserve:    nopPostObserve,
		lateInitialize: nopLateInitialize,
		isUpToDate:     alwaysUpToDate,
		preCreate:      nopPreCreate,
		postCreate:     nopPostCreate,
		preDelete:      nopPreDelete,
		postDelete:     nopPostDelete,
		preUpdate:      nopPreUpdate,
		postUpdate:     nopPostUpdate,
	}
	for _, f := range opts {
		f(e)
	}
	return e
}

type external struct {
	kube           client.Client
	client         svcsdkapi.DynamoDBAPI
	preObserve     func(context.Context, *svcapitypes.Table, *svcsdk.DescribeTableInput) error
	postObserve    func(context.Context, *svcapitypes.Table, *svcsdk.DescribeTableOutput, managed.ExternalObservation, error) (managed.ExternalObservation, error)
	lateInitialize func(*svcapitypes.TableParameters, *svcsdk.DescribeTableOutput) error
	isUpToDate     func(context.Context, *svcapitypes.Table, *svcsdk.DescribeTableOutput) (bool, string, error)
	preCreate      func(context.Context, *svcapitypes.Table, *svcsdk.CreateTableInput) error
	postCreate     func(context.Context, *svcapitypes.Table, *svcsdk.CreateTableOutput, managed.ExternalCreation, error) (managed.ExternalCreation, error)
	preDelete      func(context.Context, *svcapitypes.Table, *svcsdk.DeleteTableInput) (bool, error)
	postDelete     func(context.Context, *svcapitypes.Table, *svcsdk.DeleteTableOutput, error) (managed.ExternalDelete, error)
	preUpdate      func(context.Context, *svcapitypes.Table, *svcsdk.UpdateTableInput) error
	postUpdate     func(context.Context, *svcapitypes.Table, *svcsdk.UpdateTableOutput, managed.ExternalUpdate, error) (managed.ExternalUpdate, error)
}

func nopPreObserve(context.Context, *svcapitypes.Table, *svcsdk.DescribeTableInput) error {
	return nil
}

func nopPostObserve(_ context.Context, _ *svcapitypes.Table, _ *svcsdk.DescribeTableOutput, obs managed.ExternalObservation, err error) (managed.ExternalObservation, error) {
	return obs, err
}
func nopLateInitialize(*svcapitypes.TableParameters, *svcsdk.DescribeTableOutput) error {
	return nil
}
func alwaysUpToDate(context.Context, *svcapitypes.Table, *svcsdk.DescribeTableOutput) (bool, string, error) {
	return true, "", nil
}

func nopPreCreate(context.Context, *svcapitypes.Table, *svcsdk.CreateTableInput) error {
	return nil
}
func nopPostCreate(_ context.Context, _ *svcapitypes.Table, _ *svcsdk.CreateTableOutput, cre managed.ExternalCreation, err error) (managed.ExternalCreation, error) {
	return cre, err
}
func nopPreDelete(context.Context, *svcapitypes.Table, *svcsdk.DeleteTableInput) (bool, error) {
	return false, nil
}
func nopPostDelete(_ context.Context, _ *svcapitypes.Table, _ *svcsdk.DeleteTableOutput, err error) (managed.ExternalDelete, error) {
	return managed.ExternalDelete{}, err
}
func nopPreUpdate(context.Context, *svcapitypes.Table, *svcsdk.UpdateTableInput) error {
	return nil
}
func nopPostUpdate(_ context.Context, _ *svcapitypes.Table, _ *svcsdk.UpdateTableOutput, upd managed.ExternalUpdate, err error) (managed.ExternalUpdate, error) {
	return upd, err
}
