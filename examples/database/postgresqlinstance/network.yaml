---
apiVersion: ec2.aws.crossplane.io/v1beta1
kind: VPC
metadata:
  name: postgresql-example
spec:
  forProvider:
    region: us-east-1
    cidrBlock: 192.168.0.0/16
    enableDnsSupport: true
    enableDnsHostNames: true
  reclaimPolicy: Delete
  providerConfigRef:
    name: example
---
apiVersion: ec2.aws.crossplane.io/v1beta1
kind: Subnet
metadata:
  name: postgresql-example-1
spec:
  forProvider:
    region: us-east-1
    cidrBlock: 192.168.64.0/18
    vpcIdRef:
      name: postgresql-example
    availabilityZone: us-east-1a
  reclaimPolicy: Delete
  providerConfigRef:
    name: example
---
apiVersion: ec2.aws.crossplane.io/v1beta1
kind: Subnet
metadata:
  name: postgresql-example-2
spec:
  forProvider:
    region: us-east-1
    cidrBlock: 192.168.128.0/18
    vpcIdRef:
      name: postgresql-example
    availabilityZone: us-east-1b
  reclaimPolicy: Delete
  providerConfigRef:
    name: example
---
apiVersion: ec2.aws.crossplane.io/v1beta1
kind: Subnet
metadata:
  name: postgresql-example-3
spec:
  forProvider:
    region: us-east-1
    cidrBlock: 192.168.192.0/18
    vpcIdRef:
      name: postgresql-example
    availabilityZone: us-east-1c
  reclaimPolicy: Delete
  providerConfigRef:
    name: example
---
apiVersion: database.aws.crossplane.io/v1beta1
kind: DBSubnetGroup
metadata:
  name: postgresql-example
spec:
  forProvider:
    description: MySQL subnets
    subnetIdRefs:
      - name: postgresql-example-1
      - name: postgresql-example-2
      - name: postgresql-example-3
    tags:
      - key: name
        value: postgresql-example
  reclaimPolicy: Delete
  providerConfigRef:
    name: example
---
apiVersion: ec2.aws.crossplane.io/v1beta1
kind: InternetGateway
metadata:
  name: postgresql-example
spec:
  forProvider:
    vpcIdRef:
      name: postgresql-example
  reclaimPolicy: Delete
  providerConfigRef:
    name: example
---
apiVersion: ec2.aws.crossplane.io/v1alpha4
kind: RouteTable
metadata:
  name: postgresql-example
spec:
  forProvider:
    region: us-east-1
    vpcIdRef:
      name: postgresql-example
    routes:
      - destinationCidrBlock: 0.0.0.0/0
        gatewayIdRef:
          name: postgresql-example
    associations:
      - subnetIdRef:
          name: postgresql-example-1
      - subnetIdRef:
          name: postgresql-example-2
      - subnetIdRef:
          name: postgresql-example-3
  reclaimPolicy: Delete
  providerConfigRef:
    name: example
---
apiVersion: ec2.aws.crossplane.io/v1beta1
kind: SecurityGroup
metadata:
  name: postgresql-example
spec:
  forProvider:
    region: us-east-1
    vpcIdRef:
      name: postgresql-example
    groupName: postgresql-example
    description: Open access to RDS
    reclaimPolicy: Delete
    ingress:
      - fromPort: 3306
        toPort: 3306
        ipProtocol: tcp
        cidrBlocks:
          - cidrIp: 0.0.0.0/0
            description: Not very secure
  providerConfigRef:
    name: example
